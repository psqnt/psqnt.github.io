"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5869],{5869:(B,y,r)=>{r.r(y),r.d(y,{SettingsPageModule:()=>D});var _=r(6814),d=r(95),s=r(1929),m=r(5877),t=r(5678),C=r(6402);let T=(()=>{var e;class a{constructor(n){this.authService=n,this.npub="",this.nsec=""}ngOnInit(){this.npub=this.authService.npub(),this.nsec=this.authService.nsec()}}return(e=a).\u0275fac=function(n){return new(n||e)(t.Y36(C.$))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-keys"]],decls:20,vars:2,consts:[["fill","clear"]],template:function(n,o){1&n&&(t.TgZ(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),t._uU(3,"npub"),t.qZA(),t.TgZ(4,"ion-card-subtitle"),t._uU(5,"nip-19 encoded public key"),t.qZA()(),t.TgZ(6,"ion-card-content"),t._uU(7),t.qZA(),t.TgZ(8,"ion-button",0),t._uU(9,"Copy"),t.qZA()(),t.TgZ(10,"ion-card")(11,"ion-card-header")(12,"ion-card-title"),t._uU(13,"nsec"),t.qZA(),t.TgZ(14,"ion-card-subtitle"),t._uU(15,"nip-19 encoded private key"),t.qZA()(),t.TgZ(16,"ion-card-content"),t._uU(17),t.qZA(),t.TgZ(18,"ion-button",0),t._uU(19,"Copy"),t.qZA()()),2&n&&(t.xp6(7),t.hij(" ",o.npub," "),t.xp6(10),t.hij(" ",o.nsec," "))},dependencies:[s.YG,s.PM,s.FN,s.Zi,s.tO,s.Dq]}),a})();var u=r(5861),v=r(2848);function S(e,a){if(1&e&&(t.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label"),t._uU(3),t.qZA()()()),2&e){const i=a.$implicit;t.xp6(3),t.Oqu(i)}}let b=(()=>{var e;class a{constructor(n){this.dataService=n,this.newRelay="",this.relays=[]}ngOnInit(){this.getRelays()}getRelays(){this.relays=[],this.dataService.getRelays().subscribe(n=>{n.forEach(o=>{this.relays.push(o)})})}saveRelay(){var n=this;return(0,u.Z)(function*(){yield n.dataService.AddRelay(n.newRelay),n.newRelay="",n.getRelays()})()}}return(e=a).\u0275fac=function(n){return new(n||e)(t.Y36(v.D))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-relays"]],decls:7,vars:2,consts:[[1,"ion-padding"],["label","Add Relay","placeholder","wss://relay.damus.io/",3,"ngModel","ngModelChange"],[3,"click"],[4,"ngFor","ngForOf"]],template:function(n,o){1&n&&(t.TgZ(0,"ion-content",0)(1,"ion-list")(2,"ion-item")(3,"ion-input",1),t.NdJ("ngModelChange",function(l){return o.newRelay=l}),t.qZA(),t.TgZ(4,"ion-button",2),t.NdJ("click",function(){return o.saveRelay()}),t._uU(5,"Save"),t.qZA()()(),t.YNc(6,S,4,1,"ion-list",3),t.qZA()),2&n&&(t.xp6(3),t.Q6J("ngModel",o.newRelay),t.xp6(3),t.Q6J("ngForOf",o.relays))},dependencies:[_.sg,d.JJ,d.On,s.YG,s.W2,s.pK,s.Ie,s.Q$,s.q_,s.j9]}),a})();var w=r(9422),Z=r(9222);function x(e,a){if(1&e&&(t.TgZ(0,"div")(1,"ion-card")(2,"ion-card-content")(3,"ion-avatar"),t._UZ(4,"img",1),t.qZA()(),t.TgZ(5,"ion-card-header")(6,"ion-card-title"),t._uU(7),t.qZA()(),t.TgZ(8,"ion-card-content"),t._uU(9),t.qZA()()()),2&e){const i=t.oxw();t.xp6(4),t.s9C("src",i.picture,t.LSH),t.xp6(3),t.Oqu(i.userContent.name),t.xp6(2),t.hij(" ",i.userContent.about," ")}}function P(e,a){if(1&e){const i=t.EpF();t.TgZ(0,"div")(1,"ion-list")(2,"ion-item")(3,"ion-input",2),t.NdJ("ngModelChange",function(o){t.CHM(i);const c=t.oxw();return t.KtG(c.newName=o)}),t.qZA()(),t.TgZ(4,"ion-item")(5,"ion-input",3),t.NdJ("ngModelChange",function(o){t.CHM(i);const c=t.oxw();return t.KtG(c.newAbout=o)}),t.qZA()()(),t.TgZ(6,"ion-button",4),t.NdJ("click",function(){t.CHM(i);const o=t.oxw();return t.KtG(o.publishProfile())}),t._uU(7,"Publish Profile"),t.qZA()()}if(2&e){const i=t.oxw();t.xp6(3),t.Q6J("ngModel",i.newName),t.xp6(2),t.Q6J("ngModel",i.newAbout)}}function A(e,a){1&e&&t._UZ(0,"ion-spinner")}let U=(()=>{var e;class a{constructor(n,o,c){this.nostrService=n,this.dataService=o,this.authService=c,this.loading=!0,this.userEvent=null,this.newName="",this.newAbout="",this.userContent=null,this.picture="https://ionicframework.com/docs/img/demos/avatar.svg"}ngOnInit(){this.getUserFromRelayPool()}getUserFromRelayPool(){var n=this;return(0,u.Z)(function*(){n.dataService.getRelays().subscribe(function(){var o=(0,u.Z)(function*(c){if(null!==c){let g=[];for(var l of c)g.push(l);var p;n.userEvent=yield n.nostrService.getSelf(g),n.userEvent&&(n.userContent=JSON.parse(n.userEvent.content),null!==(p=n.userContent)&&void 0!==p&&p.picture&&(n.picture=n.userContent.picture)),n.loading=!1}});return function(c){return o.apply(this,arguments)}}())})()}publishProfile(){var n=this;const o=this.authService.getPrivateKey();let c=new w.cM(this.newName,this.newAbout,o);this.dataService.getRelays().subscribe(function(){var l=(0,u.Z)(function*(p){if(null!==p){let h=[];for(var g of p)h.push(g);n.nostrService.publishEventToPool(c.getSignedEvent(),h)}});return function(p){return l.apply(this,arguments)}}())}}return(e=a).\u0275fac=function(n){return new(n||e)(t.Y36(Z.B),t.Y36(v.D),t.Y36(C.$))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-profile"]],decls:3,vars:3,consts:[[4,"ngIf"],["alt","profile picture",3,"src"],["label","Name",3,"ngModel","ngModelChange"],["label","About",3,"ngModel","ngModelChange"],["expand","block",3,"click"]],template:function(n,o){1&n&&t.YNc(0,x,10,3,"div",0)(1,P,8,2,"div",0)(2,A,1,0,"ion-spinner",0),2&n&&(t.Q6J("ngIf",!o.loading&&o.userEvent&&o.userContent),t.xp6(1),t.Q6J("ngIf",!o.loading&&!o.userEvent),t.xp6(1),t.Q6J("ngIf",o.loading))},dependencies:[_.O5,d.JJ,d.On,s.BJ,s.YG,s.PM,s.FN,s.Zi,s.Dq,s.pK,s.Ie,s.q_,s.PQ,s.j9]}),a})(),J=(()=>{var e;class a{constructor(n,o){this.router=n,this.authService=o}signOut(){this.authService.clearKeys(),this.router.navigate(["/login"])}}return(e=a).\u0275fac=function(n){return new(n||e)(t.Y36(m.F0),t.Y36(C.$))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-signout"]],decls:6,vars:0,consts:[[1,"ion-padding"],["color","danger"],["color","danger",3,"click"]],template:function(n,o){1&n&&(t.TgZ(0,"ion-content",0)(1,"ion-text",1)(2,"h3"),t._uU(3,"Signing out will wipe data from local database. Ensure anything you want saved is backed up or on Nostr"),t.qZA()(),t.TgZ(4,"ion-button",2),t.NdJ("click",function(){return o.signOut()}),t._uU(5,"Sign Out"),t.qZA()())},dependencies:[s.YG,s.W2,s.yW]}),a})();function k(e,a){if(1&e&&(t.TgZ(0,"ion-card")(1,"ion-card-content")(2,"ion-avatar"),t._UZ(3,"img",4),t.qZA()(),t.TgZ(4,"ion-card-header")(5,"ion-card-title"),t._uU(6),t.qZA()(),t.TgZ(7,"ion-card-content"),t._uU(8),t.qZA()()),2&e){const i=a.$implicit;t.xp6(3),t.s9C("src",i.picture,t.LSH),t.xp6(3),t.Oqu(i.name),t.xp6(2),t.hij(" ",i.about," ")}}function q(e,a){if(1&e&&(t.TgZ(0,"div"),t.YNc(1,k,9,3,"ion-card",3),t.qZA()),2&e){const i=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",i.userContents)}}function M(e,a){1&e&&(t.TgZ(0,"div")(1,"ion-text"),t._uU(2,"No contacts found in database, click sync to pull from network"),t.qZA()())}function F(e,a){if(1&e){const i=t.EpF();t.TgZ(0,"div")(1,"ion-button",1),t.NdJ("click",function(){t.CHM(i);const o=t.oxw();return t.KtG(o.syncContacts())}),t._uU(2,"Sync Contacts"),t.qZA(),t.TgZ(3,"ion-button",2),t.NdJ("click",function(){t.CHM(i);const o=t.oxw();return t.KtG(o.deleteContactsFromDatabase())}),t._uU(4,"Delete Contacts"),t.qZA(),t.YNc(5,q,2,1,"div",0)(6,M,3,0,"div",0),t.qZA()}if(2&e){const i=t.oxw();t.xp6(5),t.Q6J("ngIf",i.userContents),t.xp6(1),t.Q6J("ngIf",!i.userContents)}}function R(e,a){1&e&&t._UZ(0,"ion-spinner")}let N=(()=>{var e;class a{constructor(n,o){this.nostrService=n,this.dataService=o,this.loading=!0,this.userEvents=[],this.userContents=[]}ngOnInit(){this.getContacts()}getContacts(){this.dataService.getContactList().subscribe(n=>{if(null===n)this.syncContacts();else for(var o of n)this.userContents.push(o);this.loading=!1})}syncContacts(){var n=this;return(0,u.Z)(function*(){n.loading=!0,yield n.deleteContactsFromDatabase(),n.dataService.getRelays().subscribe(function(){var o=(0,u.Z)(function*(c){if(null!==c){let g=[];for(var l of c)g.push(l);const h=yield n.nostrService.getContactList(g);if(h){const z=n.getPubkeysFromContactListEvent(h);for(var p of(n.userEvents=yield n.nostrService.getUsersFromContactList(g,z),n.userEvents)){let f=JSON.parse(p.content);null!=f&&f.picture||(f.picture="https://axiumradonmitigations.com/wp-content/uploads/2015/01/icon-user-default.png"),n.userContents.push(f),yield n.dataService.addContact(f)}}}n.loading=!1});return function(c){return o.apply(this,arguments)}}())})()}deleteContacts(){var n=this;return(0,u.Z)(function*(){n.loading=!0,yield n.deleteContactsFromDatabase(),n.loading=!1})()}deleteContactsFromDatabase(){var n=this;return(0,u.Z)(function*(){n.dataService.getContactList().subscribe(function(){var o=(0,u.Z)(function*(c){if(null!==c)for(let l=0;l<c.length;l++)yield n.dataService.removeContact(l)});return function(c){return o.apply(this,arguments)}}())})()}getPubkeysFromContactListEvent(n){let o=[];for(var c of n.tags)o.push(c[1]);return o}}return(e=a).\u0275fac=function(n){return new(n||e)(t.Y36(Z.B),t.Y36(v.D))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-contacts"]],decls:2,vars:2,consts:[[4,"ngIf"],["color","primary",3,"click"],["color","danger",3,"click"],[4,"ngFor","ngForOf"],["alt","profile picture",3,"src"]],template:function(n,o){1&n&&t.YNc(0,F,7,2,"div",0)(1,R,1,0,"ion-spinner",0),2&n&&(t.Q6J("ngIf",!o.loading),t.xp6(1),t.Q6J("ngIf",o.loading))},dependencies:[_.sg,_.O5,s.BJ,s.YG,s.PM,s.FN,s.Zi,s.Dq,s.PQ,s.yW]}),a})();function Q(e,a){if(1&e){const i=t.EpF();t.TgZ(0,"ion-list",11)(1,"ion-item",12),t.NdJ("click",function(){t.CHM(i);const o=t.oxw();return t.KtG(o.switchComponent("keys"))}),t._UZ(2,"ion-icon",13),t.TgZ(3,"ion-label")(4,"strong"),t._uU(5,"Keys"),t.qZA()()(),t.TgZ(6,"ion-item",12),t.NdJ("click",function(){t.CHM(i);const o=t.oxw();return t.KtG(o.switchComponent("relays"))}),t._UZ(7,"ion-icon",14),t.TgZ(8,"ion-label")(9,"strong"),t._uU(10,"Relays"),t.qZA()()(),t.TgZ(11,"ion-item",12),t.NdJ("click",function(){t.CHM(i);const o=t.oxw();return t.KtG(o.switchComponent("profile"))}),t._UZ(12,"ion-icon",15),t.TgZ(13,"ion-label")(14,"strong"),t._uU(15,"Profile"),t.qZA()()(),t.TgZ(16,"ion-item",12),t.NdJ("click",function(){t.CHM(i);const o=t.oxw();return t.KtG(o.switchComponent("contacts"))}),t._UZ(17,"ion-icon",16),t.TgZ(18,"ion-label")(19,"strong"),t._uU(20,"Contacts"),t.qZA()()(),t.TgZ(21,"ion-item",12),t.NdJ("click",function(){t.CHM(i);const o=t.oxw();return t.KtG(o.switchComponent("signout"))}),t._UZ(22,"ion-icon",17),t.TgZ(23,"ion-label")(24,"strong"),t._uU(25,"Sign out"),t.qZA()()()()}2&e&&(t.Q6J("inset",!0),t.xp6(1),t.Q6J("button",!0),t.xp6(5),t.Q6J("button",!0),t.xp6(5),t.Q6J("button",!0),t.xp6(5),t.Q6J("button",!0),t.xp6(5),t.Q6J("button",!0))}function O(e,a){if(1&e){const i=t.EpF();t.TgZ(0,"ion-button",18),t.NdJ("click",function(){t.CHM(i);const o=t.oxw();return t.KtG(o.setAllComponentsFalse())}),t._UZ(1,"ion-icon",19),t._uU(2,"Back "),t.qZA()}}function I(e,a){1&e&&t._UZ(0,"app-keys")}function K(e,a){1&e&&t._UZ(0,"app-relays")}function Y(e,a){1&e&&t._UZ(0,"app-profile")}function E(e,a){1&e&&t._UZ(0,"app-contacts")}function G(e,a){1&e&&t._UZ(0,"app-signout")}const L=[{path:"",component:(()=>{var e;class a{constructor(){this.title="Settings",this.showList=!0,this.showKeys=!1,this.showRelays=!1,this.showProfile=!1,this.showContacts=!1,this.showSignOut=!1}switchComponent(n){this.setAllComponentsFalse(),"keys"===n&&(this.title="Keys",this.showList=!1,this.showKeys=!0),"relays"===n&&(this.title="Relays",this.showList=!1,this.showRelays=!0),"profile"===n&&(this.title="Profile",this.showList=!1,this.showProfile=!0),"contacts"===n&&(this.title="Contacts",this.showList=!1,this.showContacts=!0),"signout"===n&&(this.title="Sign Out",this.showList=!1,this.showSignOut=!0)}setAllComponentsFalse(){this.title="Settings",this.showList=!0,this.showKeys=!1,this.showRelays=!1,this.showProfile=!1,this.showContacts=!1,this.showSignOut=!1}}return(e=a).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-settings"]],decls:25,vars:10,consts:[[3,"translucent"],["slot","start"],["slot","end"],["slot","icon-only","name","share-social-outline"],["slot","icon-only","name","add-outline"],["slot","icon-only","name","search"],["collapse","condense"],["size","large"],[3,"inset",4,"ngIf"],["fill","clear",3,"click",4,"ngIf"],[4,"ngIf"],[3,"inset"],[3,"button","click"],["color","primary","slot","start","name","key-outline","size","large"],["color","secondary","slot","start","name","server-outline","size","large"],["color","success","slot","start","name","person-circle-outline","size","large"],["color","contacts","slot","start","name","people-outline","size","large"],["color","danger","slot","start","name","power-sharp","size","large"],["fill","clear",3,"click"],["slot","start","name","chevron-back-outline"]],template:function(n,o){1&n&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),t._UZ(3,"ion-menu-button"),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.qZA(),t.TgZ(6,"ion-buttons",2)(7,"ion-button"),t._UZ(8,"ion-icon",3),t.qZA(),t.TgZ(9,"ion-button"),t._UZ(10,"ion-icon",4),t.qZA(),t.TgZ(11,"ion-button"),t._UZ(12,"ion-icon",5),t.qZA()()()(),t.TgZ(13,"ion-content")(14,"ion-header",6)(15,"ion-toolbar")(16,"ion-title",7),t._uU(17),t.qZA()()(),t.YNc(18,Q,26,6,"ion-list",8)(19,O,3,0,"ion-button",9)(20,I,1,0,"app-keys",10)(21,K,1,0,"app-relays",10)(22,Y,1,0,"app-profile",10)(23,E,1,0,"app-contacts",10)(24,G,1,0,"app-signout",10),t.qZA()),2&n&&(t.Q6J("translucent",!0),t.xp6(5),t.Oqu(o.title),t.xp6(12),t.Oqu(o.title),t.xp6(1),t.Q6J("ngIf",o.showList),t.xp6(1),t.Q6J("ngIf",!o.showList),t.xp6(1),t.Q6J("ngIf",o.showKeys),t.xp6(1),t.Q6J("ngIf",o.showRelays),t.xp6(1),t.Q6J("ngIf",o.showProfile),t.xp6(1),t.Q6J("ngIf",o.showContacts),t.xp6(1),t.Q6J("ngIf",o.showSignOut))},dependencies:[_.O5,s.YG,s.Sm,s.W2,s.Gu,s.gu,s.Ie,s.Q$,s.q_,s.fG,s.wd,s.sr,T,b,U,J,N]}),a})()}];let H=(()=>{var e;class a{}return(e=a).\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[m.Bz.forChild(L),m.Bz]}),a})(),D=(()=>{var e;class a{}return(e=a).\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[_.ez,d.u5,s.Pc,H]}),a})()}}]);